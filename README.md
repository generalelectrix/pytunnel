# pytunnel
```
    `/dMMMMMMMMy.     `sMMMMMm.    sMMMMy    hMMMM`   oMMMM/    yMMMMN-    `sMMMMMMm+        /hMMMMM
       -yNMMMMMMNs`     :NMMMMm.    hMMMM-   oMMMM`   hMMMm    +MMMMm.    -mMMMMMNo`      .omMMMMMMM
`        `omMMMMMMNo`    `yMMMMN-   .mMMMy   -MMMM`  `NMMM/   :MMMMd.    oNMMMMNs`      -yNMMMMMMMMM
Ny/`       `:hMMMMMMm+`    /NMMMN:   -MMMM-  `NMMM`  -MMMm   .mMMMd`   .dMMMMMy.     `+dMMMMMMMMNh+.
MMMNh/`       .sNMMMMMm/    .hMMMN/   +MMMh   hMMM`  oMMM/  `dMMMh`   +NMMMMh-     .sNMMMMMMMNy/`
MMMMMMNh+.      `+dMMMMMd:   `oNMMM+   yMMM-  oMMM`  hMMd   sMMMy`  .hMMMMd:     :hNMMMMMMNy/`
MMMMMMMMMNh+.     `:yNMMMMh-   -dMMMo  `dMMh  -MMM` `NMM/  /MMMs   /mMMMd/`   .+mMMMMMMmy:`
-+hmMMMMMMMMNdo-     .omMMMNy.  `sMMMs  .NMM- `NMM` -MMd  -NMMo  `sMMMm+`   -yNMMMMMms:`       `-+ym
   `-+ymMMMMMMMNdo-    `/hMMMNs.  :mMMy` /MMh  hMM` oMM/ `mMM+  :mMMNo`  `/dNMMMMds-`      `-+ymNMMM
       `./sdNMMMMMNmo:`  `-sNMMNo` .yMMy` oMM- oMM` hMd  hMN/ `oNMNs.  .omMMMMdo-`     `:ohmNMMMMMMM
-.         `./sdNMMMMNms:`  .+dMMm+` /NMh``hMh -MM``NM/ oMN: -dMNy. `:yNMMNdo-`    .:odNMMMMMMMMMMNd
NNmho/-.       `.:ohmMMMNms:` `:yNMd/`.hMd..mM:`NM`-Md :NN:`+NMh- .+dNMNh+.`   ./sdNMMMMMMMMNdyo/-.`
MMMMMMNNmhs/:.`     .-ohmMMMmy/. -smMh:`+Nm.-Nh hM`oM:.Nm-.hMd:`-smMNh+.` `-/ymNMMMMMMmdyo/-.`
MMMMMMMMMMMMNNmhs/:.`   `-+ydNMmy/../hNh--dm-+M:oM`hd`dd-/md/./hNmy/.``-+ymNMMMMmdyo/-.`
-/+oyhdmmNMMMMMMMMNNmhs+:.` `-/ydNmh+-:ymy:om:sh-M`N:sd-yd+-ommy/..:ohmNMNmdyo/-.`       ``.-:/+syhd
      ``..-:/osyhdmNMMMMMNmhs+:-../sddh+/ohs+h/d:N:d+h/hs/yhy/::ohmNmdyo:-.`   `.--:/osydmmNNMMMMMMM
                 `..-:/+syhdmmNNmhs+///syyooyoyoyhooysyoss++shhhy+:-...-:/+oyhdmmNNMMMMMMMMMMMMMMMMM
yssoo+++//:::----....````````.--/+oyhhyyssssysyyyhyyyyysssss++/++syhdmmNMMMMNNNNNmmmmddddhhhyyssooo+
MMMMMMMMMMMMMMNNNNNmmmmddddhhhyysssooooooosssyyhdmmdyysysssssssssoo++///:::----....`````
MMMMMMMMMMMMMNNNNmmmmmddddhhhyysssoo+ooooosssyyhdmmdyysssssssyyyssoo+++//:::----.....````
ssoo+++//:::----....````` ``..-:/+syhhyysossssyyyhyyyyysssss+///+oyhdmmNNMMMMMNNNNmmmmddddhhhyysssoo
                ``..-:+oshddmNNmmhs+:/+syyosyoyoyhooyoyosyo+shhhyo/-...--:/osyddmNNMMMMMMMMMMMMMMMMM
      ``.--/+oyhdmmNMMMMNNmhs/:..-/sddh+/oho+d/d:N:d+h/hs/sdy/::ohmNmdyo/-.`   ``.-:/+syhdmmNMMMMMMM
:/+syhdmNNMMMMMMMMNmdho/-.` `-+ydNmy/-:yms-sm:yh-M`N/sd-sm+-+dmh/..-+ymNMMmdyo/-.`        `.-:/+oyhd
MMMMMMMMMMMMNmdyo/-.`   .-+ymMMmy/..+dNy--dm-+M-oM`hd`hm-/mm/.:hNNh+.``-+ymNMMMMNdhs/-.`
MMMMMMNmdyo/-.     `.:ohmMMMms:``-smMh:`oNd.:Nh hM`oM/.mm-.yMd:`-smMNh+.` `-/sdNMMMMMMNdhs/-.`
Nmdyo/-.       `.:shNMMMNms:` `/hNMd/ -hMd..mM-`NM`-Md :NN: +NMh: `+dNMNdo-`   ./sdNMMMMMMMMNdhs+-.`
-`         `./sdNMMMMNmo:`  .omMMm/``+NMh``hMh -MM``NM/ +MN/ -hMMy-  :yNMMMdo-`    .:ohmNMMMMMMMMMNm
       `-+ydMMMMMMNdo-   `-yNMMm+` .yMMy` sMM- oMM` hMd  yMN/ `oNMNs.  .omMMMMds-`     `:+hmNMMMMMMM
   `-+ymMMMMMMMNdo-    `/dMMMNo`  :mMMs` /MMh  hMM` oMM/ `dMM+  -dMMNo`  `/hNMMMMms:`      `-+ymNMMM
:ohNMMMMMMMMNh+.     .smMMMNs.  `sMMMo  -NMM- `NMM` -MMd  -NMMo  `sNMMm+`   -sNMMMMMmy:`        ./sd
MMMMMMMMMNh+.     `:hMMMMNy-   -mMMM+  `mMMy  -MMM` `NMM/  /MMMs`  :mMMMm/`   `+dMMMMMMNy/`
MMMMMMNy/.      `+dMMMMMh:   `oMMMN/   yMMM-  oMMM`  hMMm   sMMMy`  `yMMMMd:     :yNMMMMMMNy/`
MMMNy/`       -sNMMMMMd/    -dMMMN/   +MMMy   hMMM`  oMMM/   hMMMh`   /NMMMMh-     .omMMMMMMMNh+.
Ny:`       `/hMMMMMMm/     +NMMMN:   :MMMM-  `NMMM`  -MMMm`  .mMMMd`   .hMMMMMy.     `/dMMMMMMMMMh+.
         .omMMMMMMN+`    .hMMMMN-   .NMMMy   -MMMM`  `NMMM/   -NMMMm.    +NMMMMMs.      -sNMMMMMMMMM
       :yMMMMMMMNo`     /NMMMMm.   `dMMMM-   oMMMM`   hMMMm`   +MMMMm.    -dMMMMMNo`      `+mMMMMMMM
    `+mMMMMMMMMy.     `yMMMMMd.    sMMMMy    hMMMM`   oMMMM+    yMMMMN-    `sMMMMMMN+        :hMMMMM
```
# What is this?

Tunnelz is a system for projecting immersive tunnels of projected light in haze,
enclosing an audience inside rich, beautiful, dynamic temporary spaces.

## Architecture

The core of tunnelz is a Python control server.  The server is responsible for
interacting with midi control interfaces, storing and updating the state of the
objects encoding the tunnels, and rendering those tunnels to a compact binary
format to send over a LAN to clients.  The clients run a compact Rust program
that exposes them to the server via DNSSD (aka Bonjour), which then subscribe to
a virtual video stream broadcast by the server and render the feeds to video.
Interaction between the server and clients is mediated by 0MQ and msgpack.

## Hardware requirements

Minimally:
- 1x Mac, which can co-host the server and a client.
- 1x digital video projector, preferably with excellent contrast.
- 1x hazer, or a lot of incense.
- 1x large-format tablet (such as an iPad) running TouchOSC.

Recommended:
- 1x Akai APC-40

Nice to have:
- Lots more projectors, with client computers to run them.

## Server installation and running (Python 2)

0. In a fresh virtual environment: $ python setup.py install
0. `$ ./run.sh`

## Controllers

Install `controller_templates/pytunnel.touchosc` on a tablet of your choice running TouchOSC.  Natively scaled for iPad.  Connect to a network midi session on the server via Audio Midi Setup/Core MIDI ([you may need to turn ipv6 off](https://discussions.apple.com/thread/7695767)).

Note that you may need to rename your network session until I fix [#20](https://github.com/generalelectrix/pytunnel/issues/20).  If you have funky midi devices connected to your system, be wary of [#17](https://github.com/generalelectrix/pytunnel/issues/17).

APC40 and APC20 should work out of the box.

## Building the render client/administrator (Mac)

0. Install Rust: https://www.rust-lang.org/tools/install
0. Install Homebrew: https://brew.sh/
0. `$ brew install sdl2`
0. `$ brew install zmq`
0. Inside `tunnelclient/` `$ cargo build --release`
0. Get up and make some tea or something while it compiles.

## Running the render client

To start the client as a remotely discoverable/configured service (uses dnssd/bonjour):
`$ cargo run --release remote`

To discover and administrate clients from the host:
`$ cargo run admin`

To start the client from a configuration file: from inside `tunnelclient/`,
`$ cargo run --release <virtual video channel (0 - 7)> <path to configuration file>`
See `tunnelclient/cfg/` for examples.